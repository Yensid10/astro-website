---
import Footer from '../components/Footer.astro'
import Navbar from '../components/Navbar.astro'
import type { PageProps } from '../components/Navbar.astro'
import {
  capitalizeFirstLetter,
  removeLeadingSlash,
  removeTrailingSlash
} from '../utils'

type LayoutProps = {
  title?: string
  navbar?: boolean
}

const url = new URL(Astro.request.url)
const currentPage = removeTrailingSlash(removeLeadingSlash(url.pathname))

const pages = await Astro.glob<PageProps>('../pages/**/*.astro')
const isBlog = Astro.canonicalURL.pathname.includes('/blog/')

const { title, navbar } = Astro.props as LayoutProps
---

<!DOCTYPE html>
<html lang='en'>
  <head>
    <!-- remove when we go public!! -->
    <meta name='robots' content='noindex' />

    <meta charset='UTF-8' />
    <meta name='viewport' content='width=device-width' />
    <link rel='icon' type='image/x-icon' href='/favicon.ico' />
    <link rel='stylesheet' href='/styles/inter.css' />
    <title>{title || capitalizeFirstLetter(currentPage)}</title>
    <!-- This is intentionally inlined to avoid FOUC -->
    <script>
      const root = document.documentElement
      const theme = localStorage.getItem('theme')
      if (
        theme === 'dark' ||
        (!theme && window.matchMedia('(prefers-color-scheme: dark)').matches)
      ) {
        root.classList.add('dark')
      } else {
        root.classList.remove('dark')
      }
    </script>
  </head>
  <body class:list={['bg-zinc-50', { 'dark:bg-zinc-900': isBlog }]}>
    {navbar && <Navbar pages={pages} />}
    <div class='pt-14'>
      <slot></slot>
      <Footer pages={pages} />
    </div>
  </body>
</html>
