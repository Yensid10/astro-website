---
import Footer from '../components/Footer.astro'
import Navbar from '../components/Navbar.astro'
import { capitalizeFirstLetter, currentPage } from '../utils'

import 'instantsearch.css/themes/satellite.css'
import '../algolia.css'
import '../shiki-theme.css'

type LayoutProps = {
  title?: string
  navbar?: boolean
  navbarNoBg?: boolean
}

const url = new URL(Astro.request.url)
const currentPageName = currentPage(url.pathname)

const [{ metaDescription }] = await Astro.glob('../data/metadata.json')

const currentDescription = metaDescription[currentPageName]

const enableDarkMode =
  Astro.url.pathname.includes('/blog') ||
  Astro.url.pathname.includes('/clojure-in')

const { title, navbar, navbarNoBg } = Astro.props as LayoutProps
---

<!DOCTYPE html>
<html lang='en'>
  <head>
    <!-- remove when we go public!! -->
    <meta name='robots' content='noindex' />

    <meta charset='UTF-8' />
    {currentDescription && (
      <meta name='description' content={currentDescription} />
    )}
    <meta name='viewport' content='width=device-width' />
    <link href='/images/favicon.png' rel='shortcut icon' type='image/x-icon' />
    <link href='/images/favicon-apple.svg' rel='apple-touch-icon' />
    <link rel='stylesheet' href='/styles/inter.css' />
    <link rel='stylesheet' href='/styles/global.css' />

    <title>{title || capitalizeFirstLetter(currentPageName)}</title>
    <!-- This is intentionally inlined to avoid FOUC -->
    <script>
      const root = document.documentElement
      const theme = localStorage.getItem('theme')
      if (
        theme === 'dark' ||
        (!theme && window.matchMedia('(prefers-color-scheme: dark)').matches)
      ) {
        root.classList.add('dark')
        document.documentElement.style.setProperty('color-scheme', 'dark')
      } else {
        document.documentElement.style.setProperty('color-scheme', 'light')
        root.classList.remove('dark')
      }
    </script>
    <style>
      html {
        scroll-behavior: smooth;
      }
    </style>
  </head>
  <body
    class:list={[
      'bg-gray-50 transition-colors',
      { 'dark:bg-gray-900': enableDarkMode }
    ]}
  >
    {navbar && <Navbar navbarNoBg={navbarNoBg} />}
    <div class:list={[{ 'pt-14': !navbarNoBg }]}>
      <slot />
      <Footer />
    </div>
  </body>
</html>
